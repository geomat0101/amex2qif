#!/usr/bin/env python

import sys
import csv

dining = (
   "AMY'S PATIO CAFE",
   "ANNIA'S KITCHEN",
   'CAFE',
   "COCO'S",
   "DENNY'S",
   "MARIA'S ITALIAN",
   "MCDONALD'S",
   "RUBIO'S",
   "SHARKY's WOODFIRED",
   'BLACK ANGUS',
   'BURGER',
   'BY BRAZIL',
   'CARROWS',
   'CHICK-FIL-A',
   'CHIPOTLE',
   'Central Park',
   'EL PORTAL',
   'FRESCOS FAMILY',
   'FU SHING',
   'GAUCHOS VILLAGE',
   'GREEN STREET',
   'HOMETOWN BUFFET',
   'ISLAMORADA FISH',
   'KATHLEEN S',
   'MARGARITAS MEXICAN',
   'MIJARES',
   'MONROVIAN FAMILY',
   'NEW DELHI PALACE',
   'OAK TREE INN',
   'PANERA BREAD',
   'PASADENA SANDWICH',
   'PF CHANGS',
   'PHILS FISH MKT',
   'PIZZA REV',
   'PRESIDENT THAI',
   'RED LOBSTER',
   'RED ROBIN',
   'ROBINS WOOD FIRE',
   'SAHARA RESTAURANT',
   'SIZZLER',
   'SOUPLANTATION',
   'STEER N ALE',
   'STONEFIRE GRILL',
   'SUBWAY',
   'SUSHI',
   'TIPPAROS',
   'ZELO PIZZERIA',
)

catmap = {
   'CULINART' : 'Dining:JPL',
   '1&1 INTERNET' : 'Computer:Domain Name Service',
   'GARFIELD BEACH CVS' : 'Medical:Medicine',
   'GABRIELS MENS WEAR' : 'Clothing:Jonathan',
   'COSTCO GAS' : 'Auto:Fuel',
   'CHEVRON' : 'Auto:Fuel',
   'EXXONMOBIL' : 'Auto:Fuel',
   'UNION 76' : 'Auto:Fuel',
   'HONDA OF PASADENA' : 'Auto:Service',
   'Norm Reeves Honda' : 'Auto:Service',
   'ALBERTSONS' : 'Groceries',
   'RALPHS' : 'Groceries',
   'SPROUTS FARMERS' : 'Groceries',
   'VONS STORE' : 'Groceries',
   }   


with open(sys.argv[1], 'r') as csvfile:
   csvreader = csv.reader(csvfile, delimiter=',', quotechar='"')
   for i, row in enumerate(csvreader):
      if len(row) == 0:
         # Ignore blank lines
         continue
      if len(row) < 5:
         print >> sys.stderr, "Error in line %d: only %d field(s)!" % (i, len(row))
         continue

      if 0:
         date = row[0].split()[0]
         ref = None
         payee = row[2]
         customer = row[3].split()[0]
         amount = -float(row[7])
         memo = None
      else:
         date = row[0]
         ref = row[1].split()[1]
         amount = float(row[2])
         payee = row[3]
         memo = row[4]
         customer = None
         # customer = row[3].split()[0]

      category = ''

      for d in dining:
         if d in payee:
            category = 'Dining'

      for p,cat in catmap.items():
         if p in payee:
            category = cat

      if customer:
         category += "/%s" % customer

      if memo and ref:
         memo += " Ref: %s" % ref

      print "D%s" % date
      print "T%.2f" % amount
      print "P%s" % payee
      print "L%s" % category
      if memo:
         print "M%s" % memo
      print "^"

